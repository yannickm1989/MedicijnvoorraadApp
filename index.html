<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Medicijn Voorraad</title>
<style>
  body { font-family: Arial, sans-serif; margin: 20px; }
  h1 { text-align: center; color: #007bff; }
  
  .form-group { display: flex; flex-direction: column; margin-bottom: 12px; }
  input[type="text"], input[type="number"], input[type="date"], select {
    font-size: 18px;
    padding: 12px;
    border-radius: 6px;
    border: 1px solid #ccc;
  }
  button { padding: 12px; font-size: 18px; background-color: #007bff; color: white; border: none; border-radius: 6px; cursor: pointer; }
  button:hover { background-color: #0056b3; }

  #searchInput { margin: 20px 0; padding: 10px; font-size: 16px; width: 100%; border-radius: 6px; border: 1px solid #ccc; }

  #medList {
    margin-top: 20px;
    display: flex;
    flex-direction: column;
    gap: 12px;
  }

  .med-block {
    padding: 16px;
    border-radius: 8px;
    background-color: #e7f0ff;
    color: #007bff;
    font-size: 20px;
    min-height: 80vh; /* vult bijna het hele scherm op mobiel */
    display: flex;
    align-items: center;
    justify-content: space-between;
    cursor: pointer;
  }
  .med-block.low { color: red; font-weight: bold; }
  .med-block.expired { color: darkred; font-weight: bold; }

  .detail { padding: 10px; border: 1px solid #ccc; border-radius: 6px; margin-bottom: 20px; }
</style>
</head>
<body>

<h1>Medicijn Voorraad</h1>

<main>
  <h3>Nieuw medicijn toevoegen</h3>
  <div class="form-group">
    <input type="text" id="medName" placeholder="Naam medicijn" />
  </div>
  <div class="form-group">
    <select id="medType">
      <option value="Tabletten">Tabletten</option>
      <option value="Pillen">Pillen</option>
      <option value="Poeder">Poeder</option>
      <option value="Spuiten">Spuiten</option>
      <option value="Volume">Volume</option>
    </select>
  </div>
  <div class="form-group">
    <input type="number" id="medAmount" placeholder="Aantal" />
  </div>
  <div class="form-group">
    <input type="number" id="medMin" placeholder="Minimum" />
  </div>
  <div class="form-group">
    <input type="date" id="medExpiry" placeholder="Houdbaar tot" />
  </div>
  <div class="form-group">
    <button id="addBtn">Opslaan</button>
  </div>

  <input type="text" id="searchInput" placeholder="Zoek medicijn..." />
  <div id="medList"></div>
</main>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
  import { getFirestore, collection, addDoc, getDocs, doc, updateDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyAlKynm9wJiGUb-8iBonZIXFi9HlmFrpUM",
    authDomain: "medicijnvoorraad.firebaseapp.com",
    projectId: "medicijnvoorraad",
    storageBucket: "medicijnvoorraad.firebasestorage.app",
    messagingSenderId: "497097674862",
    appId: "1:497097674862:web:63f894596ce65e424e567f",
    measurementId: "G-JTBPNH538Z"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const medCol = collection(db, "MedicijnVoorraad");

  const medList = document.getElementById("medList");
  const searchInput = document.getElementById("searchInput");

  async function addMed() {
    const name = document.getElementById("medName").value;
    const type = document.getElementById("medType").value;
    const amount = Number(document.getElementById("medAmount").value);
    const min = Number(document.getElementById("medMin").value);
    const expiry = document.getElementById("medExpiry").value;

    if (!name || !amount || !min) { alert("Vul alle verplichte velden in"); return; }

    await addDoc(medCol, { name, type, amount, min, expiry });
    loadMeds();
    document.getElementById("medName").value = "";
    document.getElementById("medAmount").value = "";
    document.getElementById("medMin").value = "";
    document.getElementById("medExpiry").value = "";
  }

  async function loadMeds() {
    medList.innerHTML = "";
    const snapshot = await getDocs(medCol);
    const meds = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
    const query = searchInput.value.toLowerCase();
    const today = new Date();

    meds.filter(m => m.name.toLowerCase().includes(query)).forEach(m => {
      const div = document.createElement("div");
      div.className = "med-block";

      if (m.expiry && new Date(m.expiry) < today) {
        div.classList.add("expired");
        div.textContent = `${m.name} (VERVALLEN!)`;
      } else if (m.amount < m.min) {
        div.classList.add("low");
        div.textContent = `${m.name} (bijna op: ${m.amount})`;
      } else {
        div.textContent = m.name;
      }

      div.addEventListener("click", () => showDetail(m));
      medList.appendChild(div);
    });
  }

  async function showDetail(m) {
    const detail = document.createElement("div");
    detail.className = "detail";
    detail.innerHTML = `
      <strong>Naam:</strong> <input type="text" id="nameInput" value="${m.name}"><br>
      <strong>Type:</strong>
      <select id="typeInput">
        <option value="Tabletten" ${m.type=="Tabletten"?"selected":""}>Tabletten</option>
        <option value="Pillen" ${m.type=="Pillen"?"selected":""}>Pillen</option>
        <option value="Poeder" ${m.type=="Poeder"?"selected":""}>Poeder</option>
        <option value="Spuiten" ${m.type=="Spuiten"?"selected":""}>Spuiten</option>
        <option value="Volume" ${m.type=="Volume"?"selected":""}>Volume</option>
      </select><br>
      <strong>Aantal:</strong> <input type="number" id="amountInput" value="${m.amount}"><br>
      <strong>Minimum:</strong> <input type="number" id="minInput" value="${m.min}"><br>
      <strong>Houdbaar tot:</strong> <input type="date" id="expiryInput" value="${m.expiry || ''}"><br>
      <button id="updateBtn">Update</button>
      <button id="deleteBtn" style="background-color:red;">Delete</button>
    `;
    medList.innerHTML = "";
    medList.appendChild(detail);

    document.getElementById("updateBtn").onclick = async () => {
      await updateDoc(doc(medCol, m.id), {
        name: document.getElementById("nameInput").value,
        type: document.getElementById("typeInput").value,
        amount: Number(document.getElementById("amountInput").value),
        min: Number(document.getElementById("minInput").value),
        expiry: document.getElementById("expiryInput").value
      });
      loadMeds();
    };

    document.getElementById("deleteBtn").onclick = async () => {
      if (confirm("Weet je zeker dat je dit medicijn wilt verwijderen?")) {
        await deleteDoc(doc(medCol, m.id));
        loadMeds();
      }
    };
  }

  document.getElementById("addBtn").addEventListener("click", addMed);
  searchInput.addEventListener("input", loadMeds);

  loadMeds();
</script>

</body>
</html>
