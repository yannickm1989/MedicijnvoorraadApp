<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8">
<title>MedicijnVoorraad</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
    body {
        font-family: Arial, sans-serif;
        background: #f3f3f3;
        margin: 0;
        padding: 0;
    }

    header {
        background: #0d6efd;
        padding: 15px;
        color: white;
        text-align: center;
        font-size: 22px;
        font-weight: bold;
    }

    .container {
        padding: 15px;
    }

    label {
        font-weight: bold;
        font-size: 15px;
    }

    input, select {
        width: 100%;
        padding: 10px;
        margin-top: 5px;
        margin-bottom: 12px;
        border-radius: 5px;
        border: 1px solid #ccc;
        font-size: 16px;
    }

    button {
        width: 100%;
        padding: 12px;
        background: #0d6efd;
        border: none;
        color: white;
        border-radius: 5px;
        font-size: 18px;
        margin-top: 10px;
    }

    .list-block {
        background: white;
        padding: 10px;
        border-top: 2px solid #0d6efd;
        margin-top: 20px;
    }

    .med-item {
        padding: 10px;
        border-bottom: 1px solid #ddd;
        font-size: 18px;
    }

    .low {
        color: red;
        font-weight: bold;
    }

    .normal {
        color: #0d6efd;
    }
</style>
</head>

<body>

<header>MedicijnVoorraad</header>

<div class="container">

    <label>Naam medicijn</label>
    <input id="name" type="text">

    <label>Type</label>
    <select id="type">
        <option value="tabletten">Tabletten</option>
        <option value="pillen">Pillen</option>
        <option value="poeder">Poeder</option>
        <option value="spuiten">Spuiten</option>
        <option value="volume">Volume (ml)</option>
    </select>

    <label>Aantal</label>
    <input id="amount" type="number">

    <label>Minimum</label>
    <input id="min" type="number">

    <label>Houdbaar tot</label>
    <input id="expiry" type="date">

    <button id="saveBtn">Opslaan</button>
</div>

<div class="list-block" id="list"></div>

<!-- FIREBASE -->
<script type="module">

import { initializeApp }
    from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";

import {
    getFirestore, collection, addDoc, getDocs,
    updateDoc, doc
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
    apiKey: "AIzaSyAlKynm9wJiGUb-8iBonZIXFi9HlmFrpUM",
    authDomain: "medicijnvoorraad.firebaseapp.com",
    projectId: "medicijnvoorraad",
    storageBucket: "medicijnvoorraad.firebasestorage.app",
    messagingSenderId: "497097674862",
    appId: "1:497097674862:web:63f894596ce65e424e567f",
    measurementId: "G-JTBPNH538Z"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

let currentID = null;

/* OPSLAAN / UPDATEN */
async function saveMedicine() {
    const data = {
        name: document.getElementById("name").value,
        type: document.getElementById("type").value,
        amount: Number(document.getElementById("amount").value),
        min: Number(document.getElementById("min").value),
        expiry: document.getElementById("expiry").value
    };

    if (currentID) {
        await updateDoc(doc(db, "meds", currentID), data);
    } else {
        await addDoc(collection(db, "meds"), data);
    }

    currentID = null;
    document.getElementById("saveBtn").textContent = "Opslaan";
    document.getElementById("name").value = "";
    document.getElementById("amount").value = "";
    document.getElementById("min").value = "";
    document.getElementById("expiry").value = "";

    loadList();
}

document.getElementById("saveBtn").onclick = saveMedicine;

/* LADEN VAN LIJST */
async function loadList() {
    const snap = await getDocs(collection(db, "meds"));

    const list = document.getElementById("list");
    list.innerHTML = "";

    snap.forEach(d => {
        const med = d.data();
        const item = document.createElement("div");

        const isLow = med.amount <= med.min;
        const isExpired = med.expiry && new Date(med.expiry) < new Date();

        item.className = "med-item " + (isLow || isExpired ? "low" : "normal");

        item.textContent = med.name + " (" + med.amount + ")";

        item.onclick = () => {
            document.getElementById("name").value = med.name;
            document.getElementById("type").value = med.type;
            document.getElementById("amount").value = med.amount;
            document.getElementById("min").value = med.min;
            document.getElementById("expiry").value = med.expiry;

            currentID = d.id;
            document.getElementById("saveBtn").textContent = "Aanpassen";
        };

        list.appendChild(item);
    });
}

loadList();

</script>

</body>
</html>
